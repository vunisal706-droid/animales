<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Capitul√≠n - Aventura en la Selva</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23FFD700'/%3E%3Ccircle cx='35' cy='40' r='5' fill='%23333'/%3E%3Ccircle cx='65' cy='40' r='5' fill='%23333'/%3E%3Cpath d='M 35 60 Q 50 70 65 60' stroke='%23333' stroke-width='3' fill='none'/%3E%3Cpath d='M 30 20 Q 35 10 40 20' fill='%238B4513'/%3E%3Cpath d='M 60 20 Q 65 10 70 20' fill='%238B4513'/%3E%3C/svg%3E">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
        }

        #root {
            width: 100%;
            height: 100%;
        }

        canvas {
            display: block;
        }

        input, select, textarea {
            font-size: 16px !important;
        }

        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Sistema de sonido
        const SoundSystem = {
          audioContext: null,
          
          init() {
            if (!this.audioContext) {
              this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
          },

          playSuccess() {
            this.init();
            const oscillator = this.audioContext.createOscillator();
            const gainNode = this.audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(this.audioContext.destination);
            
            oscillator.frequency.value = 523.25;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
            
            oscillator.start(this.audioContext.currentTime);
            oscillator.stop(this.audioContext.currentTime + 0.5);
            
            const oscillator2 = this.audioContext.createOscillator();
            const gainNode2 = this.audioContext.createGain();
            
            oscillator2.connect(gainNode2);
            gainNode2.connect(this.audioContext.destination);
            
            oscillator2.frequency.value = 659.25;
            oscillator2.type = 'sine';
            
            gainNode2.gain.setValueAtTime(0.3, this.audioContext.currentTime + 0.1);
            gainNode2.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.6);
            
            oscillator2.start(this.audioContext.currentTime + 0.1);
            oscillator2.stop(this.audioContext.currentTime + 0.6);
          },

          playCollect() {
            this.init();
            const oscillator = this.audioContext.createOscillator();
            const gainNode = this.audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(this.audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'square';
            
            gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.2);
            
            oscillator.start(this.audioContext.currentTime);
            oscillator.stop(this.audioContext.currentTime + 0.2);
          },

          playLevelComplete() {
            this.init();
            for (let i = 0; i < 3; i++) {
              const oscillator = this.audioContext.createOscillator();
              const gainNode = this.audioContext.createGain();
              
              oscillator.connect(gainNode);
              gainNode.connect(this.audioContext.destination);
              
              oscillator.frequency.value = 523.25 + (i * 100);
              oscillator.type = 'sine';
              
              gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime + (i * 0.15));
              gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + (i * 0.15) + 0.3);
              
              oscillator.start(this.audioContext.currentTime + (i * 0.15));
              oscillator.stop(this.audioContext.currentTime + (i * 0.15) + 0.3);
            }
          }
        };

        // Configuraci√≥n de niveles
        const LEVELS = {
          level1: {
            platforms: [
              { x: 0, y: 450, width: 800, height: 50 },
              { x: 100, y: 350, width: 120, height: 20 },
              { x: 350, y: 300, width: 140, height: 20 },
              { x: 600, y: 350, width: 130, height: 20 },
              { x: 150, y: 200, width: 100, height: 20 },
              { x: 500, y: 150, width: 110, height: 20 }
            ],
            background: 'linear-gradient(to bottom, #87CEEB, #90EE90)',
            platformColor: '#8B4513'
          },
          level2: {
            platforms: [
              { x: 0, y: 450, width: 800, height: 50 },
              { x: 50, y: 380, width: 100, height: 20 },
              { x: 250, y: 320, width: 120, height: 20 },
              { x: 500, y: 380, width: 100, height: 20 },
              { x: 680, y: 320, width: 100, height: 20 },
              { x: 300, y: 200, width: 150, height: 20 },
              { x: 100, y: 150, width: 100, height: 20 }
            ],
            background: 'linear-gradient(to bottom, #FFB6C1, #FFE4E1)',
            platformColor: '#CD853F'
          },
          level3: {
            platforms: [
              { x: 0, y: 450, width: 800, height: 50 },
              { x: 200, y: 370, width: 130, height: 20 },
              { x: 450, y: 300, width: 120, height: 20 },
              { x: 100, y: 250, width: 110, height: 20 },
              { x: 600, y: 250, width: 120, height: 20 },
              { x: 350, y: 170, width: 100, height: 20 },
              { x: 50, y: 120, width: 100, height: 20 }
            ],
            background: 'linear-gradient(to bottom, #E0BBE4, #FEC8D8)',
            platformColor: '#A0522D'
          },
          level4: {
            platforms: [
              { x: 0, y: 450, width: 800, height: 50 },
              { x: 650, y: 380, width: 130, height: 20 },
              { x: 400, y: 340, width: 120, height: 20 },
              { x: 150, y: 300, width: 110, height: 20 },
              { x: 550, y: 240, width: 100, height: 20 },
              { x: 250, y: 180, width: 130, height: 20 },
              { x: 500, y: 120, width: 100, height: 20 }
            ],
            background: 'linear-gradient(to bottom, #B4F8C8, #FBE7C6)',
            platformColor: '#8B6914'
          },
          level5: {
            platforms: [
              { x: 0, y: 450, width: 800, height: 50 },
              { x: 120, y: 390, width: 100, height: 20 },
              { x: 320, y: 350, width: 140, height: 20 },
              { x: 580, y: 300, width: 120, height: 20 },
              { x: 180, y: 240, width: 110, height: 20 },
              { x: 450, y: 180, width: 100, height: 20 },
              { x: 650, y: 150, width: 100, height: 20 }
            ],
            background: 'linear-gradient(to bottom, #A8E6CF, #FFD3B6)',
            platformColor: '#704214'
          }
        };

        const CapitulinGame = () => {
          const [screen, setScreen] = useState('start');
          const [gameMode, setGameMode] = useState(null);
          const [currentLevel, setCurrentLevel] = useState(1);
          const [totalAnimalsFreed, setTotalAnimalsFreed] = useState(0);
          const [coins, setCoins] = useState(0);
          const [currentCostume, setCurrentCostume] = useState('default');
          const [ownedCostumes, setOwnedCostumes] = useState(['default']);
          const [showQuestion, setShowQuestion] = useState(false);
          const [currentAnimal, setCurrentAnimal] = useState(null);
          const [showFeedback, setShowFeedback] = useState(null);
          const [playerPos, setPlayerPos] = useState({ x: 50, y: 300 });
          const [velocity, setVelocity] = useState({ x: 0, y: 0 });
          const [isJumping, setIsJumping] = useState(false);
          const [cagePositions, setCagePositions] = useState([]);
          const [showLevelComplete, setShowLevelComplete] = useState(false);
          const keysPressed = useRef({});
          const gameLoopRef = useRef(null);
          const canvasRef = useRef(null);

          const animals = [
            { name: 'üêï Perro', domestic: 'domestico', habitat: 'terrestre', diet: 'omnivoro' },
            { name: 'üêà Gato', domestic: 'domestico', habitat: 'terrestre', diet: 'carnivoro' },
            { name: 'üêÑ Vaca', domestic: 'domestico', habitat: 'terrestre', diet: 'herbivoro' },
            { name: 'üê¥ Caballo', domestic: 'domestico', habitat: 'terrestre', diet: 'herbivoro' },
            { name: 'ü¶Å Le√≥n', domestic: 'salvaje', habitat: 'terrestre', diet: 'carnivoro' },
            { name: 'üêØ Tigre', domestic: 'salvaje', habitat: 'terrestre', diet: 'carnivoro' },
            { name: 'üêò Elefante', domestic: 'salvaje', habitat: 'terrestre', diet: 'herbivoro' },
            { name: 'ü¶í Jirafa', domestic: 'salvaje', habitat: 'terrestre', diet: 'herbivoro' },
            { name: 'üêª Oso', domestic: 'salvaje', habitat: 'terrestre', diet: 'omnivoro' },
            { name: 'üê¨ Delf√≠n', domestic: 'salvaje', habitat: 'acuatico', diet: 'carnivoro' },
            { name: 'ü¶à Tibur√≥n', domestic: 'salvaje', habitat: 'acuatico', diet: 'carnivoro' },
            { name: 'üê† Pez', domestic: 'salvaje', habitat: 'acuatico', diet: 'omnivoro' },
            { name: 'ü¶Ö √Åguila', domestic: 'salvaje', habitat: 'aereo', diet: 'carnivoro' },
            { name: 'ü¶ú Loro', domestic: 'salvaje', habitat: 'aereo', diet: 'omnivoro' },
            { name: 'ü¶â B√∫ho', domestic: 'salvaje', habitat: 'aereo', diet: 'carnivoro' },
            { name: 'üêî Gallina', domestic: 'domestico', habitat: 'terrestre', diet: 'omnivoro' },
            { name: 'ü¶Ü Pato', domestic: 'domestico', habitat: 'acuatico', diet: 'omnivoro' },
            { name: 'üêµ Mono', domestic: 'salvaje', habitat: 'terrestre', diet: 'omnivoro' },
            { name: 'üê∑ Cerdo', domestic: 'domestico', habitat: 'terrestre', diet: 'omnivoro' },
            { name: 'üê∞ Conejo', domestic: 'domestico', habitat: 'terrestre', diet: 'herbivoro' }
          ];

          const costumes = [
            { id: 'default', name: 'Capitul√≠n', price: 0 },
            { id: 'superman', name: 'Superman', price: 5 },
            { id: 'spiderman', name: 'Spiderman', price: 5 },
            { id: 'hulk', name: 'Hulk', price: 5 },
            { id: 'thor', name: 'Thor', price: 5 },
            { id: 'mario', name: 'Mario Bros', price: 5 },
            { id: 'batman', name: 'Batman', price: 5 },
            { id: 'ironman', name: 'Iron Man', price: 5 }
          ];

          const getCurrentLevelData = () => {
            const levelKey = `level${currentLevel}`;
            return LEVELS[levelKey] || LEVELS.level1;
          };

          // Dibujar personaje en canvas
          const drawCharacter = (ctx, x, y, costume) => {
            ctx.save();
            ctx.translate(x, y);

            // Configuraci√≥n seg√∫n disfraz
            let bodyColor = '#FFD700';
            let headColor = '#FFDAB9';
            let showCape = false;
            let capeColor = '';
            let showHammer = false;
            let showCircle = false;
            let circleColor = '';
            let isGreen = false;
            let isRobot = false;

            switch(costume) {
              case 'superman':
                bodyColor = '#0047AB';
                showCape = true;
                capeColor = '#DC143C';
                showCircle = true;
                circleColor = '#DC143C';
                break;
              case 'batman':
                bodyColor = '#2C2C2C';
                showCape = true;
                capeColor = '#000000';
                showCircle = true;
                circleColor = '#FFD700';
                break;
              case 'spiderman':
                bodyColor = '#DC143C';
                headColor = '#DC143C';
                showCircle = true;
                circleColor = '#000000';
                break;
              case 'hulk':
                bodyColor = '#228B22';
                headColor = '#228B22';
                isGreen = true;
                break;
              case 'thor':
                bodyColor = '#4169E1';
                showHammer = true;
                break;
              case 'ironman':
                bodyColor = '#DC143C';
                headColor = '#FFD700';
                isRobot = true;
                break;
              case 'mario':
                bodyColor = '#FF0000';
                headColor = '#FFDAB9';
                break;
            }

            // Capa (detr√°s)
            if (showCape) {
              ctx.fillStyle = capeColor;
              ctx.beginPath();
              ctx.moveTo(5, 10);
              ctx.lineTo(-5, 10);
              ctx.lineTo(-8, 25);
              ctx.lineTo(8, 25);
              ctx.closePath();
              ctx.fill();
            }

            // Piernas
            ctx.fillStyle = '#4169E1';
            ctx.fillRect(-4, 20, 3, 12); // Pierna izquierda
            ctx.fillRect(1, 20, 3, 12);  // Pierna derecha

            // Zapatos
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(-5, 32, 4, 3);
            ctx.fillRect(1, 32, 4, 3);

            // Cuerpo
            ctx.fillStyle = bodyColor;
            ctx.fillRect(-6, 8, 12, 14);

            // C√≠rculo en el pecho
            if (showCircle) {
              ctx.fillStyle = circleColor;
              ctx.beginPath();
              ctx.arc(0, 15, 3, 0, Math.PI * 2);
              ctx.fill();
            }

            // Brazos
            ctx.fillStyle = bodyColor;
            ctx.fillRect(-8, 10, 2, 10); // Brazo izquierdo
            ctx.fillRect(6, 10, 2, 10);  // Brazo derecho

            // Manos
            ctx.fillStyle = headColor;
            ctx.beginPath();
            ctx.arc(-7, 20, 2, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(7, 20, 2, 0, Math.PI * 2);
            ctx.fill();

            // Martillo de Thor
            if (showHammer) {
              ctx.fillStyle = '#808080';
              ctx.fillRect(8, 18, 2, 8); // Mango
              ctx.fillStyle = '#C0C0C0';
              ctx.fillRect(6, 16, 6, 4); // Cabeza del martillo
            }

            // Cabeza
            ctx.fillStyle = headColor;
            ctx.beginPath();
            ctx.arc(0, 4, 6, 0, Math.PI * 2);
            ctx.fill();

            // Ojos
            if (isRobot) {
              ctx.fillStyle = '#00FFFF';
              ctx.fillRect(-3, 2, 2, 2);
              ctx.fillRect(1, 2, 2, 2);
            } else {
              ctx.fillStyle = '#000000';
              ctx.beginPath();
              ctx.arc(-2, 3, 1, 0, Math.PI * 2);
              ctx.fill();
              ctx.beginPath();
              ctx.arc(2, 3, 1, 0, Math.PI * 2);
              ctx.fill();
            }

            // Sonrisa
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(0, 5, 3, 0, Math.PI);
            ctx.stroke();

            // Pelo/Gorra para Mario
            if (costume === 'mario') {
              ctx.fillStyle = '#8B4513';
              ctx.fillRect(-5, -2, 10, 3);
            }

            ctx.restore();
          };

          useEffect(() => {
            if (screen === 'game' && cagePositions.length === 0) {
              generateCages();
            }
          }, [screen, currentLevel]);

          useEffect(() => {
            if (screen === 'game' && !showQuestion && !showLevelComplete) {
              gameLoopRef.current = setInterval(() => {
                updateGame();
              }, 1000 / 60);

              return () => {
                if (gameLoopRef.current) {
                  clearInterval(gameLoopRef.current);
                }
              };
            }
          }, [screen, showQuestion, showLevelComplete, playerPos.x, playerPos.y, velocity.y, isJumping]);

          useEffect(() => {
            const handleKeyDown = (e) => {
              keysPressed.current[e.key] = true;
              if ((e.key === 'ArrowUp' || e.key === ' ') && !isJumping && !showQuestion && !showLevelComplete) {
                setVelocity(v => ({ ...v, y: -12 }));
                setIsJumping(true);
              }
            };

            const handleKeyUp = (e) => {
              keysPressed.current[e.key] = false;
            };

            window.addEventListener('keydown', handleKeyDown);
            window.addEventListener('keyup', handleKeyUp);

            return () => {
              window.removeEventListener('keydown', handleKeyDown);
              window.removeEventListener('keyup', handleKeyUp);
            };
          }, [isJumping, showQuestion, showLevelComplete]);

          const generateCages = () => {
            const levelData = getCurrentLevelData();
            const newCages = levelData.platforms.slice(1).map((platform, idx) => ({
              x: platform.x + platform.width / 2 - 20,
              y: platform.y - 45,
              collected: false,
              id: idx
            }));
            setCagePositions(newCages);
          };

          const updateGame = () => {
            const levelData = getCurrentLevelData();
            
            setPlayerPos(prev => {
              let newX = prev.x;

              if (keysPressed.current['ArrowLeft']) {
                newX -= 5;
              }
              if (keysPressed.current['ArrowRight']) {
                newX += 5;
              }

              newX = Math.max(0, Math.min(770, newX));

              return { ...prev, x: newX };
            });

            setVelocity(prev => {
              let newVelY = prev.y + 0.5;
              
              levelData.platforms.forEach(platform => {
                if (
                  playerPos.x + 15 > platform.x &&
                  playerPos.x - 15 < platform.x + platform.width &&
                  playerPos.y + 35 >= platform.y &&
                  playerPos.y + 35 <= platform.y + 20 &&
                  newVelY >= 0
                ) {
                  newVelY = 0;
                  setPlayerPos(p => ({ ...p, y: platform.y - 35 }));
                  setIsJumping(false);
                }
              });

              return { ...prev, y: newVelY };
            });

            setPlayerPos(prev => ({
              ...prev,
              y: Math.min(prev.y + velocity.y, 465)
            }));

            cagePositions.forEach(cage => {
              if (
                !cage.collected &&
                Math.abs(playerPos.x - cage.x - 20) < 35 &&
                Math.abs(playerPos.y - cage.y - 20) < 35
              ) {
                collectCage(cage.id);
              }
            });

            // Verificar si se complet√≥ el nivel
            const allCollected = cagePositions.every(cage => cage.collected);
            if (allCollected && cagePositions.length > 0 && !showLevelComplete) {
              completeLevel();
            }
          };

          const collectCage = (cageId) => {
            SoundSystem.playCollect();

            setCagePositions(prev =>
              prev.map(cage =>
                cage.id === cageId ? { ...cage, collected: true } : cage
              )
            );

            const randomAnimal = animals[Math.floor(Math.random() * animals.length)];
            setCurrentAnimal(randomAnimal);
            setShowQuestion(true);
          };

          const completeLevel = () => {
            SoundSystem.playLevelComplete();
            setShowLevelComplete(true);
          };

          const nextLevel = () => {
            if (currentLevel < 5) {
              setCurrentLevel(currentLevel + 1);
              setPlayerPos({ x: 50, y: 300 });
              setVelocity({ x: 0, y: 0 });
              setIsJumping(false);
              setCagePositions([]);
              setShowLevelComplete(false);
            } else {
              // Juego completado - volver al men√∫
              alert('¬°Felicidades! ¬°Has completado todos los niveles!');
              resetGame();
              setScreen('menu');
            }
          };

          const handleAnswer = (answer) => {
            let correct = false;
            let correctAnswer = '';

            if (gameMode === 'domestic') {
              correct = answer === currentAnimal.domestic;
              correctAnswer = currentAnimal.domestic;
            } else if (gameMode === 'habitat') {
              correct = answer === currentAnimal.habitat;
              correctAnswer = currentAnimal.habitat;
            } else if (gameMode === 'diet') {
              correct = answer === currentAnimal.diet;
              correctAnswer = currentAnimal.diet;
            }

            if (correct) {
              SoundSystem.playSuccess();
              setShowFeedback('correct');
              setCoins(c => c + 1); // +1 moneda por cada respuesta correcta
              setTotalAnimalsFreed(t => t + 1);
              
              setTimeout(() => {
                setShowFeedback(null);
                setShowQuestion(false);
                setCurrentAnimal(null);
              }, 1500);
            } else {
              setShowFeedback({ type: 'incorrect', correct: correctAnswer });
              
              setTimeout(() => {
                setShowFeedback(null);
                setShowQuestion(false);
                setCurrentAnimal(null);
              }, 3000);
            }
          };

          const buyCostume = (costumeId) => {
            const costume = costumes.find(c => c.id === costumeId);
            if (coins >= costume.price && !ownedCostumes.includes(costumeId)) {
              setCoins(c => c - costume.price);
              setOwnedCostumes([...ownedCostumes, costumeId]);
              setCurrentCostume(costumeId);
            } else if (ownedCostumes.includes(costumeId)) {
              setCurrentCostume(costumeId);
            }
          };

          const getOptionLabel = (mode, option) => {
            if (mode === 'domestic') {
              return option === 'domestico' ? 'Dom√©stico' : 'Salvaje';
            } else if (mode === 'habitat') {
              if (option === 'terrestre') return 'Terrestre';
              if (option === 'acuatico') return 'Acu√°tico';
              if (option === 'aereo') return 'A√©reo';
            } else if (mode === 'diet') {
              if (option === 'herbivoro') return 'Herb√≠voro';
              if (option === 'carnivoro') return 'Carn√≠voro';
              if (option === 'omnivoro') return 'Omn√≠voro';
            }
          };

          const resetGame = () => {
            setCurrentLevel(1);
            setPlayerPos({ x: 50, y: 300 });
            setVelocity({ x: 0, y: 0 });
            setIsJumping(false);
            setCagePositions([]);
            setShowQuestion(false);
            setCurrentAnimal(null);
            setShowFeedback(null);
            setShowLevelComplete(false);
          };

          // Renderizar canvas del juego
          useEffect(() => {
            if (screen === 'game' && canvasRef.current) {
              const canvas = canvasRef.current;
              const ctx = canvas.getContext('2d');
              
              // Limpiar canvas
              ctx.clearRect(0, 0, canvas.width, canvas.height);

              const levelData = getCurrentLevelData();

              // Dibujar plataformas
              ctx.fillStyle = levelData.platformColor;
              levelData.platforms.forEach(platform => {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                ctx.strokeStyle = '#654321';
                ctx.lineWidth = 2;
                ctx.strokeRect(platform.x, platform.y, platform.width, platform.height);
              });

              // Dibujar cajas
              cagePositions.forEach(cage => {
                if (!cage.collected) {
                  ctx.font = '40px Arial';
                  ctx.fillText('üì¶', cage.x, cage.y + 35);
                }
              });

              // Dibujar personaje
              drawCharacter(ctx, playerPos.x, playerPos.y, currentCostume);
            }
          });

          if (screen === 'start') {
            return (
              <div style={{
                width: '100vw',
                height: '100vh',
                background: 'linear-gradient(to bottom, #87CEEB, #90EE90)',
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'center',
                justifyContent: 'center',
                fontFamily: 'Arial, sans-serif'
              }}>
                <div style={{ fontSize: '4rem', marginBottom: '20px' }}>üßí</div>
                <h1 style={{ fontSize: 'clamp(2rem, 8vw, 3rem)', color: '#2C5F2D', textShadow: '3px 3px #FFD700', marginBottom: '10px', textAlign: 'center' }}>
                  CAPITUL√çN
                </h1>
                <h2 style={{ fontSize: 'clamp(1rem, 4vw, 1.5rem)', color: '#FF6347', marginBottom: '40px', textAlign: 'center' }}>
                  Aventura en la Selva
                </h2>
                <button
                  onClick={() => setScreen('menu')}
                  style={{
                    fontSize: 'clamp(1.5rem, 5vw, 2rem)',
                    padding: '20px 60px',
                    backgroundColor: '#FF6347',
                    color: 'white',
                    border: 'none',
                    borderRadius: '20px',
                    cursor: 'pointer',
                    fontWeight: 'bold',
                    boxShadow: '0 8px #C04030'
                  }}
                >
                  ¬°JUGAR! üéÆ
                </button>
              </div>
            );
          }

          if (screen === 'menu') {
            return (
              <div style={{
                width: '100vw',
                height: '100vh',
                background: 'linear-gradient(to bottom, #87CEEB, #90EE90)',
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'center',
                justifyContent: 'center',
                fontFamily: 'Arial, sans-serif',
                padding: '20px'
              }}>
                <h2 style={{ fontSize: 'clamp(1.5rem, 6vw, 2.5rem)', color: '#2C5F2D', marginBottom: '40px', textAlign: 'center' }}>
                  Elige tu Aventura
                </h2>
                
                <button
                  onClick={() => { setGameMode('domestic'); resetGame(); setScreen('game'); }}
                  style={{
                    fontSize: 'clamp(1rem, 4vw, 1.5rem)',
                    padding: '20px 40px',
                    margin: '15px',
                    backgroundColor: '#FFD700',
                    color: '#2C5F2D',
                    border: '4px solid #FFA500',
                    borderRadius: '15px',
                    cursor: 'pointer',
                    fontWeight: 'bold',
                    width: '90%',
                    maxWidth: '500px'
                  }}
                >
                  üè† vs üå¥ Dom√©sticos o Salvajes
                </button>

                <button
                  onClick={() => { setGameMode('habitat'); resetGame(); setScreen('game'); }}
                  style={{
                    fontSize: 'clamp(1rem, 4vw, 1.5rem)',
                    padding: '20px 40px',
                    margin: '15px',
                    backgroundColor: '#87CEEB',
                    color: '#2C5F2D',
                    border: '4px solid #4682B4',
                    borderRadius: '15px',
                    cursor: 'pointer',
                    fontWeight: 'bold',
                    width: '90%',
                    maxWidth: '500px'
                  }}
                >
                  üöó üö¢ ‚úàÔ∏è Terrestre, Acu√°tico o A√©reo
                </button>

                <button
                  onClick={() => { setGameMode('diet'); resetGame(); setScreen('game'); }}
                  style={{
                    fontSize: 'clamp(1rem, 4vw, 1.5rem)',
                    padding: '20px 40px',
                    margin: '15px',
                    backgroundColor: '#90EE90',
                    color: '#2C5F2D',
                    border: '4px solid #228B22',
                    borderRadius: '15px',
                    cursor: 'pointer',
                    fontWeight: 'bold',
                    width: '90%',
                    maxWidth: '500px'
                  }}
                >
                  üå± ü•© üçî Herb√≠voro, Carn√≠voro u Omn√≠voro
                </button>

                <button
                  onClick={() => setScreen('stats')}
                  style={{
                    fontSize: 'clamp(0.9rem, 3vw, 1.2rem)',
                    padding: '15px 30px',
                    marginTop: '30px',
                    backgroundColor: '#FF69B4',
                    color: 'white',
                    border: 'none',
                    borderRadius: '10px',
                    cursor: 'pointer',
                    fontWeight: 'bold'
                  }}
                >
                  üìä Ver Estad√≠sticas
                </button>

                <button
                  onClick={() => setScreen('shop')}
                  style={{
                    fontSize: 'clamp(0.9rem, 3vw, 1.2rem)',
                    padding: '15px 30px',
                    marginTop: '10px',
                    backgroundColor: '#FFA500',
                    color: 'white',
                    border: 'none',
                    borderRadius: '10px',
                    cursor: 'pointer',
                    fontWeight: 'bold'
                  }}
                >
                  üõçÔ∏è Tienda
                </button>
              </div>
            );
          }

          if (screen === 'stats') {
            return (
              <div style={{
                width: '100vw',
                height: '100vh',
                background: 'linear-gradient(to bottom, #FFE4E1, #FFF0F5)',
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'center',
                justifyContent: 'center',
                fontFamily: 'Arial, sans-serif',
                padding: '20px'
              }}>
                <h2 style={{ fontSize: 'clamp(1.5rem, 6vw, 2.5rem)', color: '#FF1493', marginBottom: '30px', textAlign: 'center' }}>
                  üìä Estad√≠sticas de Capitul√≠n
                </h2>
                
                <div style={{
                  backgroundColor: 'white',
                  padding: '30px',
                  borderRadius: '20px',
                  boxShadow: '0 4px 8px rgba(0,0,0,0.2)',
                  minWidth: '80%',
                  maxWidth: '400px'
                }}>
                  <p style={{ fontSize: 'clamp(1.2rem, 4vw, 1.8rem)', margin: '20px 0', color: '#333' }}>
                    ü¶Å Animales liberados: <strong>{totalAnimalsFreed}</strong>
                  </p>
                  <p style={{ fontSize: 'clamp(1.2rem, 4vw, 1.8rem)', margin: '20px 0', color: '#333' }}>
                    üé≠ Trajes conseguidos: <strong>{ownedCostumes.length}/8</strong>
                  </p>
                  <p style={{ fontSize: 'clamp(1.2rem, 4vw, 1.8rem)', margin: '20px 0', color: '#333' }}>
                    ü™ô Monedas disponibles: <strong>{coins}</strong>
                  </p>
                </div>

                <button
                  onClick={() => setScreen('menu')}
                  style={{
                    fontSize: 'clamp(1rem, 4vw, 1.5rem)',
                    padding: '15px 40px',
                    marginTop: '40px',
                    backgroundColor: '#FF69B4',
                    color: 'white',
                    border: 'none',
                    borderRadius: '15px',
                    cursor: 'pointer',
                    fontWeight: 'bold'
                  }}
                >
                  ‚¨ÖÔ∏è Volver al Men√∫
                </button>
              </div>
            );
          }

          if (screen === 'shop') {
            return (
              <div style={{
                width: '100vw',
                height: '100vh',
                background: 'linear-gradient(to bottom, #FFE4B5, #FFDAB9)',
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'center',
                justifyContent: 'flex-start',
                fontFamily: 'Arial, sans-serif',
                padding: '20px',
                overflowY: 'auto'
              }}>
                <h2 style={{ fontSize: 'clamp(1.5rem, 6vw, 2.5rem)', color: '#8B4513', marginBottom: '20px', textAlign: 'center' }}>
                  üõçÔ∏è Tienda de Trajes
                </h2>
                <p style={{ fontSize: 'clamp(1rem, 4vw, 1.5rem)', color: '#D2691E', marginBottom: '30px' }}>
                  Monedas disponibles: ü™ô {coins}
                </p>

                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))',
                  gap: '15px',
                  width: '100%',
                  maxWidth: '800px',
                  marginBottom: '20px'
                }}>
                  {costumes.map(costume => {
                    const owned = ownedCostumes.includes(costume.id);
                    const canBuy = coins >= costume.price;
                    const isCurrent = currentCostume === costume.id;

                    // Crear mini preview del disfraz
                    const previewCanvas = document.createElement('canvas');
                    previewCanvas.width = 60;
                    previewCanvas.height = 60;
                    const ctx = previewCanvas.getContext('2d');
                    drawCharacter(ctx, 30, 30, costume.id);
                    const previewImage = previewCanvas.toDataURL();

                    return (
                      <div
                        key={costume.id}
                        onClick={() => (owned || canBuy) && buyCostume(costume.id)}
                        style={{
                          backgroundColor: isCurrent ? '#FFD700' : owned ? '#90EE90' : canBuy ? 'white' : '#D3D3D3',
                          padding: '15px',
                          borderRadius: '15px',
                          textAlign: 'center',
                          cursor: (owned || canBuy) ? 'pointer' : 'not-allowed',
                          border: isCurrent ? '4px solid #FF6347' : '3px solid #8B4513',
                          boxShadow: '0 4px 6px rgba(0,0,0,0.2)'
                        }}
                      >
                        <img src={previewImage} style={{ width: '60px', height: '60px', marginBottom: '5px' }} />
                        <div style={{ fontSize: 'clamp(0.8rem, 3vw, 1.2rem)', fontWeight: 'bold', marginBottom: '5px' }}>
                          {costume.name}
                        </div>
                        <div style={{ fontSize: 'clamp(0.7rem, 2.5vw, 1rem)', color: '#666' }}>
                          {costume.price === 0 ? 'Gratis' : `ü™ô ${costume.price}`}
                        </div>
                        {isCurrent && <div style={{ color: '#FF6347', fontWeight: 'bold', marginTop: '5px', fontSize: 'clamp(0.7rem, 2.5vw, 0.9rem)' }}>EQUIPADO</div>}
                        {owned && !isCurrent && <div style={{ color: '#228B22', fontWeight: 'bold', marginTop: '5px', fontSize: 'clamp(0.7rem, 2.5vw, 0.9rem)' }}>Equipar</div>}
                      </div>
                    );
                  })}
                </div>

                <button
                  onClick={() => setScreen('menu')}
                  style={{
                    fontSize: 'clamp(1rem, 4vw, 1.5rem)',
                    padding: '15px 40px',
                    backgroundColor: '#FF6347',
                    color: 'white',
                    border: 'none',
                    borderRadius: '15px',
                    cursor: 'pointer',
                    fontWeight: 'bold',
                    marginTop: '20px'
                  }}
                >
                  Volver al Men√∫
                </button>
              </div>
            );
          }

          if (screen === 'game') {
            const levelData = getCurrentLevelData();
            
            return (
              <div style={{
                width: '100vw',
                height: '100vh',
                background: levelData.background,
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'center',
                justifyContent: 'center',
                fontFamily: 'Arial, sans-serif',
                position: 'relative',
                overflow: 'hidden'
              }}>
                <div style={{
                  position: 'absolute',
                  top: '10px',
                  left: '10px',
                  display: 'flex',
                  gap: '10px',
                  zIndex: 100
                }}>
                  <button
                    onClick={() => setScreen('menu')}
                    style={{
                      padding: '10px 20px',
                      backgroundColor: '#FF6347',
                      color: 'white',
                      border: 'none',
                      borderRadius: '10px',
                      cursor: 'pointer',
                      fontSize: 'clamp(0.8rem, 3vw, 1rem)',
                      fontWeight: 'bold'
                    }}
                  >
                    üè† Men√∫
                  </button>
                </div>

                <div style={{
                  position: 'absolute',
                  top: '10px',
                  right: '10px',
                  backgroundColor: 'rgba(255,255,255,0.9)',
                  padding: '10px 15px',
                  borderRadius: '10px',
                  fontSize: 'clamp(0.9rem, 3vw, 1.3rem)',
                  fontWeight: 'bold',
                  zIndex: 100
                }}>
                  Nivel {currentLevel} | ü™ô {coins}
                </div>

                <canvas
                  ref={canvasRef}
                  width={800}
                  height={500}
                  style={{
                    border: '5px solid #2C5F2D',
                    borderRadius: '10px',
                    maxWidth: '95vw',
                    maxHeight: '70vh',
                    backgroundColor: '#8FBC8F'
                  }}
                />

                <div style={{
                  marginTop: '15px',
                  fontSize: 'clamp(0.8rem, 3vw, 1.2rem)',
                  color: '#2C5F2D',
                  fontWeight: 'bold',
                  textAlign: 'center',
                  padding: '0 10px'
                }}>
                  Usa las flechas ‚¨ÖÔ∏è ‚û°Ô∏è ‚¨ÜÔ∏è para moverte y saltar
                </div>

                {showLevelComplete && (
                  <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    width: '100vw',
                    height: '100vh',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000
                  }}>
                    <div style={{
                      backgroundColor: 'white',
                      padding: '40px',
                      borderRadius: '20px',
                      textAlign: 'center'
                    }}>
                      <h2 style={{ fontSize: '3rem', color: '#FFD700', marginBottom: '20px' }}>
                        üéâ ¬°NIVEL COMPLETADO! üéâ
                      </h2>
                      <button
                        onClick={nextLevel}
                        style={{
                          fontSize: '1.5rem',
                          padding: '15px 40px',
                          backgroundColor: '#4CAF50',
                          color: 'white',
                          border: 'none',
                          borderRadius: '15px',
                          cursor: 'pointer',
                          fontWeight: 'bold'
                        }}
                      >
                        {currentLevel < 5 ? 'Siguiente Nivel ‚û°Ô∏è' : '¬°Finalizar!'}
                      </button>
                    </div>
                  </div>
                )}

                {showQuestion && currentAnimal && (
                  <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    width: '100vw',
                    height: '100vh',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 1000,
                    padding: '20px'
                  }}>
                    <div style={{
                      backgroundColor: 'white',
                      padding: 'clamp(20px, 5vw, 40px)',
                      borderRadius: '20px',
                      textAlign: 'center',
                      maxWidth: '90%',
                      maxHeight: '90%',
                      overflowY: 'auto'
                    }}>
                      <div style={{ fontSize: 'clamp(2.5rem, 10vw, 4rem)', marginBottom: '20px' }}>
                        {currentAnimal.name}
                      </div>

                      {showFeedback === 'correct' && (
                        <div style={{
                          fontSize: 'clamp(2rem, 8vw, 3rem)',
                          color: '#228B22',
                          fontWeight: 'bold',
                          marginBottom: '20px'
                        }}>
                          ¬°CORRECTO! üéâ +1ü™ô
                        </div>
                      )}

                      {showFeedback && showFeedback.type === 'incorrect' && (
                        <div>
                          <div style={{
                            fontSize: 'clamp(1.5rem, 6vw, 2rem)',
                            color: '#FF6347',
                            fontWeight: 'bold',
                            marginBottom: '20px'
                          }}>
                            No es correcto üòä
                          </div>
                          <div style={{
                            fontSize: 'clamp(1.2rem, 5vw, 1.8rem)',
                            color: '#333',
                            marginBottom: '20px'
                          }}>
                            La respuesta correcta es: <strong>{getOptionLabel(gameMode, showFeedback.correct)}</strong>
                          </div>
                        </div>
                      )}

                      {!showFeedback && (
                        <>
                          <h3 style={{ fontSize: 'clamp(1.3rem, 5vw, 2rem)', marginBottom: '30px', color: '#333' }}>
                            ¬øQu√© tipo de animal es?
                          </h3>

                          <div style={{
                            display: 'flex',
                            flexDirection: 'column',
                            gap: '15px',
                            alignItems: 'center'
                          }}>
                            {gameMode === 'domestic' && (
                              <>
                                <button
                                  onClick={() => handleAnswer('domestico')}
                                  style={{
                                    fontSize: 'clamp(1.2rem, 5vw, 1.8rem)',
                                    padding: '15px 30px',
                                    backgroundColor: '#FFD700',
                                    border: '3px solid #FFA500',
                                    borderRadius: '15px',
                                    cursor: 'pointer',
                                    width: '90%',
                                    maxWidth: '300px'
                                  }}
                                >
                                  üè† Dom√©stico
                                </button>
                                <button
                                  onClick={() => handleAnswer('salvaje')}
                                  style={{
                                    fontSize: 'clamp(1.2rem, 5vw, 1.8rem)',
                                    padding: '15px 30px',
                                    backgroundColor: '#90EE90',
                                    border: '3px solid #228B22',
                                    borderRadius: '15px',
                                    cursor: 'pointer',
                                    width: '90%',
                                    maxWidth: '300px'
                                  }}
                                >
                                  üå¥ Salvaje
                                </button>
                              </>
                            )}

                            {gameMode === 'habitat' && (
                              <>
                                <button
                                  onClick={() => handleAnswer('terrestre')}
                                  style={{
                                    fontSize: 'clamp(1.2rem, 5vw, 1.8rem)',
                                    padding: '15px 30px',
                                    backgroundColor: '#D2691E',
                                    color: 'white',
                                    border: '3px solid #8B4513',
                                    borderRadius: '15px',
                                    cursor: 'pointer',
                                    width: '90%',
                                    maxWidth: '300px'
                                  }}
                                >
                                  üöó Terrestre
                                </button>
                                <button
                                  onClick={() => handleAnswer('acuatico')}
                                  style={{
                                    fontSize: 'clamp(1.2rem, 5vw, 1.8rem)',
                                    padding: '15px 30px',
                                    backgroundColor: '#4682B4',
                                    color: 'white',
                                    border: '3px solid #1E3A8A',
                                    borderRadius: '15px',
                                    cursor: 'pointer',
                                    width: '90%',
                                    maxWidth: '300px'
                                  }}
                                >
                                  üö¢ Acu√°tico
                                </button>
                                <button
                                  onClick={() => handleAnswer('aereo')}
                                  style={{
                                    fontSize: 'clamp(1.2rem, 5vw, 1.8rem)',
                                    padding: '15px 30px',
                                    backgroundColor: '#87CEEB',
                                    border: '3px solid #4682B4',
                                    borderRadius: '15px',
                                    cursor: 'pointer',
                                    width: '90%',
                                    maxWidth: '300px'
                                  }}
                                >
                                  ‚úàÔ∏è A√©reo
                                </button>
                              </>
                            )}

                            {gameMode === 'diet' && (
                              <>
                                <button
                                  onClick={() => handleAnswer('herbivoro')}
                                  style={{
                                    fontSize: 'clamp(1.2rem, 5vw, 1.8rem)',
                                    padding: '15px 30px',
                                    backgroundColor: '#90EE90',
                                    border: '3px solid #228B22',
                                    borderRadius: '15px',
                                    cursor: 'pointer',
                                    width: '90%',
                                    maxWidth: '300px'
                                  }}
                                >
                                  üå± Herb√≠voro
                                </button>
                                <button
                                  onClick={() => handleAnswer('carnivoro')}
                                  style={{
                                    fontSize: 'clamp(1.2rem, 5vw, 1.8rem)',
                                    padding: '15px 30px',
                                    backgroundColor: '#FF6347',
                                    color: 'white',
                                    border: '3px solid #C04030',
                                    borderRadius: '15px',
                                    cursor: 'pointer',
                                    width: '90%',
                                    maxWidth: '300px'
                                  }}
                                >
                                  ü•© Carn√≠voro
                                </button>
                                <button
                                  onClick={() => handleAnswer('omnivoro')}
                                  style={{
                                    fontSize: 'clamp(1.2rem, 5vw, 1.8rem)',
                                    padding: '15px 30px',
                                    backgroundColor: '#FFD700',
                                    border: '3px solid #FFA500',
                                    borderRadius: '15px',
                                    cursor: 'pointer',
                                    width: '90%',
                                    maxWidth: '300px'
                                  }}
                                >
                                  üçî Omn√≠voro
                                </button>
                              </>
                            )}
                          </div>
                        </>
                      )}
                    </div>
                  </div>
                )}
              </div>
            );
          }

          return null;
        };

        ReactDOM.render(<CapitulinGame />, document.getElementById('root'));
    </script>
</body>
</html>